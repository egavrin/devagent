{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ast.query request",
  "type": "object",
  "properties": {
    "path": { "type": "string" },
    "paths": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1
    },
    "query": { "type": "string" },
    "mode": {
      "type": "string",
      "enum": ["query", "summary", "symbols"]
    },
    "captures": {
      "type": "array",
      "items": { "type": "string" }
    },
    "include_context": { "type": "boolean" }
  },
  "additionalProperties": false,
  "allOf": [
    {
      "anyOf": [
        { "required": ["path"] },
        { "required": ["paths"] }
      ]
    },
    {
      "if": {
        "properties": { "mode": { "const": "summary" } }
      },
      "then": {
        "$comment": "Summary mode does not require a query."
      },
      "else": {
        "required": ["query"]
      }
    }
  ]
}
